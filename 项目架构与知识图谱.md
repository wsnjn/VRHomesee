# 智能选房平台：项目神经架构图谱

> **版本：** v2.4 (Max Stability)  
> **核心架构：** Vue3 + SpringBoot + AI + VR

---

## 一、 系统全景解剖图 (System Architecture)

```mermaid
flowchart TD
    subgraph Front ["Frontend - Vue3"]
        UI[App.vue 主容器]
        Router[Router 导航]
        TenantView["租客视图层"]
        LandlordView["房东视图层"]
        VRComponent["VR 交互组件"]
        MapAPI["高德地图组件"]
    end

    subgraph Back ["Backend - SpringBoot"]
        API[Controller 接口层]
        Service[Service 逻辑层]
        Repo[Repository 数据层]
    end

    subgraph External ["External Services"]
        LLM["AI 大模型 (ModelScope)"]
        OSS["VR 资源存储"]
    end

    %% 交互流转
    UI --> Router
    Router --> TenantView
    Router --> LandlordView
    TenantView --> VRComponent
    
    TenantView -->|HTTP| API
    API --> Service
    Service --> Repo
    
    Service --> LLM
    VRComponent --> OSS
```

---

## 二、 核心业务流：AI 辅助 3D 选房 (Sequence Flow)

```mermaid
sequenceDiagram
    participant U as 租客
    participant A as AI 代理
    participant M as 匹配引擎
    participant V as VR 服务
    participant D as 数据库

    U->>A: 提出选房需求
    A->>M: 提取匹配参数
    M->>D: 检索房源
    D-->>M: 返回数据
    M-->>A: 生成推荐列表
    A-->>U: AI 推荐语
    U->>V: 启动 VR 漫游
    V-->>U: 渲染 3D 场景
```

---

## 三、 核心文件功能实录 (Components Lexicon)

*   **`RoomInfo.java`**: 房源核心。支持区域、价格、面积的多维检索。
*   **`RoomVrScene.java`**: VR 插件。实现 3D 场景在 3js 中的映射。
*   **`TenantManagementService.java`**: 租务管家。处理签约、水电数字化及费用结算。
*   **`AiProxyController.java`**: AI 网关。后端流式转发，确保对话秒级响应并保护 API 密钥。

---

## 四、 实体关系图 (ER Map)

```mermaid
erDiagram
    USER ||--o{ ROOM_INFO : "发布 (作为房东)"
    USER ||--o{ TENANT_MANAGEMENT : "承租 (作为租客)"
    USER ||--o{ TENANT_MANAGEMENT : "管理 (作为房东)"
    USER ||--o{ VIEWING_APPOINTMENT : "发起/接收"
    USER ||--o{ SOCIAL_POST : "发布"
    USER ||--o{ MAINTENANCE_REQUEST : "提交 (作为租客)"
    USER ||--o{ CHAT_MESSAGE : "发送/接收"
    USER ||--o{ CHAT_HISTORY : "AI对话记录"

    ROOM_INFO ||--o{ ROOM_VR_SCENE : "关联 VR 场景"
    ROOM_INFO ||--o{ TENANT_MANAGEMENT : "签署合同"
    ROOM_INFO ||--o{ VIEWING_APPOINTMENT : "被预约"
    ROOM_INFO ||--o{ MAINTENANCE_REQUEST : "申报维修"

    TENANT_MANAGEMENT ||--o{ RENT_PAYMENT : "产生账单"
    TENANT_MANAGEMENT ||--o{ CONTRACT_CHANGE : "变更记录"

    SOCIAL_POST ||--o{ SOCIAL_COMMENT : "包含评论"
    SOCIAL_POST ||--o{ SOCIAL_LIKE : "获得点赞"

    CHAT_GROUP ||--o{ GROUP_MEMBER : "包含成员"
    CHAT_GROUP ||--o{ CHAT_MESSAGE : "群组消息"
```

---

## 五、 项目核心闭环

1.  **AI-选房闭环**：通过对话意图识别（LLM）驱动房源的动态权值匹配。
2.  **3D-全景闭环**：全景图片 -> 3.js 坐标映射 -> 语音合成引导 -> 沉浸式看房。
3.  **租务管理闭环**：电子租约 -> 数字化水电仪表记录 -> 售后报修流转。

---
*文档维护：牛迦楠 (Niu Jianan) | 2026-01-06*
