# Homesee 后端 API 文档

本文档提供了 Homesee Spring Boot 后端暴露的 RESTful API 的详细参考。

**基础 URL**: `http://localhost:8080` (生产环境: `https://homesee.xyz`)

---

## 1. 用户管理 (`/api/user`)

*控制器: `UserController`*

| 方法   | 端点                         | 描述                   | 请求体 / 参数                                                                                                                                                                                        |
| :----- | :--------------------------- | :--------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `POST` | `/register`                  | 注册新用户。           | JSON: `username`, `phone`, `password`, `realName`                                                                                                                                                    |
| `POST` | `/login`                     | 用户登录。             | JSON: `phone`, `password`                                                                                                                                                                            |
| `GET`  | `/{userId}`                  | 获取用户个人资料详情。 | 路径参数: `userId`                                                                                                                                                                                   |
| `PUT`  | `/update/{userId}`           | 更新用户个人资料。     | 路径参数: `userId`, JSON: `username`, `email`, `realName`, `gender`, `birthday`, `wechat`, `qq`, `job`, `company`, `monthlyIncome`, `rentalBudgetMin/Max`, `preferredDistricts`, `houseRequirements` |
| `POST` | `/upload-avatar`             | 上传用户头像。         | Multipart: `avatar` (文件), `userId`                                                                                                                                                                 |
| `GET`  | `/check-phone/{phone}`       | 检查手机号是否存在。   | 路径参数: `phone`                                                                                                                                                                                    |
| `GET`  | `/check-username/{username}` | 检查用户名是否存在。   | 路径参数: `username`                                                                                                                                                                                 |
| `GET`  | `/search/phone`              | 通过手机号搜索用户。   | 查询参数: `phone`                                                                                                                                                                                    |

---

## 2. 房源与房间列表

*控制器: `RoomInfoController` (`/api/rooms`), `RoomInfoFilterController` (`/api/room-info`), `RoomVrSceneController` (`/api/vr-scenes`)*

### 通用房源操作 (`/api/rooms`)

| 方法     | 端点           | 描述                                      | 请求体 / 参数                         |
| :------- | :------------- | :---------------------------------------- | :------------------------------------ |
| `GET`    | `/all`         | 获取所有房源 (管理员/调试)。              | -                                     |
| `GET`    | `/available`   | 获取所有可用房源 (状态=0)。               | -                                     |
| `GET`    | `/{id}`        | 获取房源详情。                            | 路径参数: `id`                        |
| `GET`    | `/statistics`  | 获取房源统计 (总数, 已租, 可租, 维修中)。 | -                                     |
| `POST`   | `/add`         | 添加新房源。                              | JSON: `RoomInfo` 对象                 |
| `PUT`    | `/update/{id}` | 更新房源详情。                            | 路径参数: `id`, JSON: `RoomInfo` 对象 |
| `PUT`    | `/{id}/status` | 更新房源状态。                            | 路径参数: `id`, 查询参数: `status`    |
| `DELETE` | `/delete/{id}` | 删除房源。                                | 路径参数: `id`                        |

### 搜索与筛选 (`/api/room-info`)

| 方法  | 端点                 | 描述                                | 请求体 / 参数                                                                                                           |
| :---- | :------------------- | :---------------------------------- | :---------------------------------------------------------------------------------------------------------------------- |
| `GET` | `/filter-options`    | 获取可用筛选值 (省份, 租赁类型等)。 | -                                                                                                                       |
| `GET` | `/filter`            | 高级搜索可用房源。                  | 查询参数: `province`, `city`, `district`, `minPrice`, `maxPrice`, `rentalType`, `bedroomCount`, `decoration`, `keyword` |
| `GET` | `/cities/{province}` | 获取省份下的城市。                  | 路径参数: `province`                                                                                                    |
| `GET` | `/districts/{city}`  | 获取城市下的行政区。                | 路径参数: `city`                                                                                                        |

### VR 场景 (`/api/vr-scenes`)

| 方法     | 端点        | 描述                 | 请求体 / 参数                            |
| :------- | :---------- | :------------------- | :--------------------------------------- |
| `GET`    | `/{roomId}` | 获取房间的 VR 场景。 | 路径参数: `roomId`                       |
| `POST`   | `/upload`   | 上传 VR 场景图片。   | Multipart: `file`, `roomId`, `sceneName` |
| `DELETE` | `/{id}`     | 删除 VR 场景。       | 路径参数: `id`                           |

---

## 3. 房东仪表板 (`/api/landlord`)

*控制器: `LandlordHouseController`, `LandlordTenantMatchingController` (`/api/landlord/matching`)*

### 房源管理

| 方法   | 端点                      | 描述                      | 请求体 / 参数                                 |
| :----- | :------------------------ | :------------------------ | :-------------------------------------------- |
| `GET`  | `/houses`                 | 获取房东的房源。          | 查询参数: `landlordPhone`                     |
| `GET`  | `/houses/status/{status}` | 按状态获取房源。          | 路径参数: `status`, 查询参数: `landlordPhone` |
| `GET`  | `/statistics`             | 房东统计 (入住率, 维修)。 | 查询参数: `landlordPhone`                     |
| `POST` | `/house`                  | 添加房源 (房东视图)。     | JSON: `RoomInfo` 字段, `landlordPhone`        |
| `PUT`  | `/house/{houseId}/status` | 更改房源状态。            | 路径参数: `houseId`, 查询参数: `status`       |

### 租客匹配与合同 (`/api/landlord/matching`)

| 方法   | 端点                         | 描述                 | 请求体 / 参数                                                                      |
| :----- | :--------------------------- | :------------------- | :--------------------------------------------------------------------------------- |
| `POST` | `/create`                    | 创建租赁合同。       | JSON: `contractNumber`, `roomId`, `tenantId`, `monthlyRent`, `depositAmount`, 日期 |
| `GET`  | `/contracts`                 | 获取房东的所有合同。 | 查询参数: `landlordPhone`                                                          |
| `GET`  | `/contracts/status/{status}` | 按状态筛选合同。     | 路径参数: `status`, 查询参数: `landlordPhone`                                      |

---

## 4. 租客与租赁管理

*控制器: `TenantManagementController` (`/api/admin/tenant`), `ViewingAppointmentController` (`/api/viewing-appointment`), `AppointmentController` (`/api/appointment`), `MaintenanceController` (`/api/maintenance`)*

### 合同 (`/api/admin/tenant`) - *管理员与租客使用*

| 方法   | 端点                 | 描述                      | 请求体 / 参数                                         |
| :----- | :------------------- | :------------------------ | :---------------------------------------------------- |
| `GET`  | `/tenant/{tenantId}` | 获取我的合同 (租客视图)。 | 路径参数: `tenantId`                                  |
| `GET`  | `/{contractId}`      | 获取合同详情。            | 路径参数: `contractId`                                |
| `PUT`  | `/{id}/rent-status`  | 更新租金支付状态。        | 路径参数: `id`, JSON: `rentStatus`                    |
| `POST` | `/meter-readings`    | 更新水电读数。            | JSON: `contractId`, `waterReading`, `electricReading` |

### 预约 (`/api/viewing-appointment`)

| 方法   | 端点                 | 描述             | 请求体 / 参数                                                  |
| :----- | :------------------- | :--------------- | :------------------------------------------------------------- |
| `POST` | `/create`            | 请求看房。       | JSON: `roomId`, `userId`, `preferredDate`, `contactName/Phone` |
| `GET`  | `/user/{userId}`     | 获取我的预约。   | 路径参数: `userId`                                             |
| `PUT`  | `/{id}/status`       | 取消/确认预约。  | 路径参数: `id`, JSON: `status`, `cancellationReason`           |
| `PUT`  | `/{id}/assign-agent` | 为预约分配中介。 | 路径参数: `id`, JSON: `agentId`                                |

### 维修 (`/api/maintenance`)

| 方法   | 端点              | 描述                     | 请求体 / 参数                   |
| :----- | :---------------- | :----------------------- | :------------------------------ |
| `POST` | `/create`         | 报告维修问题。           | JSON: `MaintenanceRequest` 字段 |
| `GET`  | `/list/{leaseId}` | 获取租赁相关的维修请求。 | 路径参数: `leaseId`             |
| `POST` | `/update`         | 更新请求状态/费用。      | JSON: `MaintenanceRequest` 字段 |

---

## 5. 社区与社交 (`/api/community`)

*控制器: `CommunityController`, `SmartMatchingController` (`/api/smart-matching`)*

### 聊天与群组

| 方法   | 端点                        | 描述                   | 请求体 / 参数                                     |
| :----- | :-------------------------- | :--------------------- | :------------------------------------------------ |
| `GET`  | `/groups/user/{userId}`     | 获取用户的聊天群组。   | 路径参数: `userId`                                |
| `POST` | `/groups/private`           | 获取/创建私聊 (私信)。 | JSON: `userId`, `friendId`                        |
| `GET`  | `/messages/group/{groupId}` | 获取聊天记录。         | 路径参数: `groupId`                               |
| `POST` | `/messages/send`            | 发送消息。             | JSON: `senderId`, `groupId`, `content`, `msgType` |

### 社交动态

| 方法   | 端点                      | 描述               | 请求体 / 参数                                                    |
| :----- | :------------------------ | :----------------- | :--------------------------------------------------------------- |
| `GET`  | `/posts`                  | 获取社区动态列表。 | -                                                                |
| `POST` | `/posts/create`           | 发布动态。         | JSON: `userId`, `content`, `mediaUrls` (JSON 数组), `visibility` |
| `POST` | `/posts/{postId}/like`    | 点赞动态。         | 路径参数: `postId`, JSON: `userId`                               |
| `POST` | `/posts/{postId}/comment` | 评论动态。         | 路径参数: `postId`, JSON: `userId`, `content`                    |

### AI 助手 (`/api/smart-matching`)

| 方法   | 端点                | 描述               | 请求体 / 参数             |
| :----- | :------------------ | :----------------- | :------------------------ |
| `POST` | `/chat`             | 与 AI 助手聊天。   | JSON: `userId`, `message` |
| `GET`  | `/history/{userId}` | 获取 AI 聊天记录。 | 路径参数: `userId`        |

---

## 6. 管理员仪表板 (`/api/admin`)

*控制器: `AdminUserController`, `AdminChannelController`, `TenantMatchingController`*

| 方法   | 端点                            | 描述                      | 请求体 / 参数              |
| :----- | :------------------------------ | :------------------------ | :------------------------- |
| `GET`  | `/user/all`                     | 列出所有系统用户。        | -                          |
| `PUT`  | `/user/{userId}/reset-password` | 重置用户密码为 '123456'。 | 路径参数: `userId`         |
| `POST` | `/channel/chat/mute`            | 在全局聊天中禁言用户。    | JSON: `userId`, `duration` |
| `POST` | `/channel/community/ban`        | 禁止用户发布动态。        | JSON: `userId`, `duration` |
| `POST` | `/matching/create`              | 管理员创建租赁合同。      | JSON: 合同详情             |
